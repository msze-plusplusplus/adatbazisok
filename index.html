<!DOCTYPE html><html><head><meta charset="utf-8"><style type="text/css">p {
  text-align: justify;
  width: 100%;
}

.page-break {
  page-break-after: always;
}

img {
  max-width: 100%;
  max-height: 20cm;
  margin: 0 auto;
  display: block;
}

table {
  border-collapse: collapse;
  margin: 0 auto;
}

table,
th,
td {
  border: 1px solid black;
}

th,
td {
  padding: 3px 5px;
}

th {
  background-color: lightgray;
}

li {
  margin: 0.6em 0;
}

code {
  padding: 2px;
  border-radius: 2px;
  background: #eaeaea;
}

blockquote {
  margin: 0;
  padding-left: 1.4rem;
  color: #535a60;
  border-left: 4px solid #dadada;
}
/*# sourceURL=style.css*/</style><style type="text/css">/*

github.com style (c) Vasily Polovnyov <vast@whiteants.net>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  color: #333;
  background: #f8f8f8;
}

.hljs-comment,
.hljs-quote {
  color: #998;
  font-style: italic;
}

.hljs-keyword,
.hljs-selector-tag,
.hljs-subst {
  color: #333;
  font-weight: bold;
}

.hljs-number,
.hljs-literal,
.hljs-variable,
.hljs-template-variable,
.hljs-tag .hljs-attr {
  color: #008080;
}

.hljs-string,
.hljs-doctag {
  color: #d14;
}

.hljs-title,
.hljs-section,
.hljs-selector-id {
  color: #900;
  font-weight: bold;
}

.hljs-subst {
  font-weight: normal;
}

.hljs-type,
.hljs-class .hljs-title {
  color: #458;
  font-weight: bold;
}

.hljs-tag,
.hljs-name,
.hljs-attribute {
  color: #000080;
  font-weight: normal;
}

.hljs-regexp,
.hljs-link {
  color: #009926;
}

.hljs-symbol,
.hljs-bullet {
  color: #990073;
}

.hljs-built_in,
.hljs-builtin-name {
  color: #0086b3;
}

.hljs-meta {
  color: #999;
  font-weight: bold;
}

.hljs-deletion {
  background: #fdd;
}

.hljs-addition {
  background: #dfd;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}
/*# sourceURL=/home/runner/work/adatbazisok/adatbazisok/pdf/node_modules/highlight.js/styles/github.css*/</style></head>
<body class="">
<center>
    <h1>
        Adatbázisok (<span style="font-weight:bold;">GKNB_INTM010</span>)
    </h1>
    <br><br><br><br><br><br><br><br><br><br>
    <h2>
        Webtárhely kezelésre szolgáló adatbázis - beadandó
    </h2>
    <br><br><br><br><br><br><br><br><br><br>
</center>

<center>
    <h4>
        Készítette: Baranyai Bence Bendegúz (<span style="font-weight:bold;">XE5TNO</span>), Karcag Tamás (<span style="font-weight:bold;">DT0QPB</span>)
    </h4>
</center>

<div class="page-break"></div>

<h1 id="webtárhely">Webtárhely</h1>
<h2 id="leírás-és-funkcionális-követelmények">Leírás és funkcionális követelmények</h2>
<p>Az általunk választott téma egy webtárhely séma alapszintű funkcióinak leképezése adatbázis szemszögből.</p>
<p>Az adatbázisban tárolhatóak az egyes webtárhelyek és azoknak adatai. Vannak webtárhely típusból jövő beállítási adatok, amik mint csomag beállítások foghatóak fel, illetve vannak a webtárhely a felhasználói által specializált konfigurációs beállítások. Ezek a beállítások együtt alkotják, majd a webtárhely költségeit. A webtárhelyek létrehozásánál, ki lehet választani, hogy melyik szerver központba jöjjön létre a mi tárhelyünk.</p>
<p>A adatbázisban tárolva vannak a felhasználók és adataik, akik a webtárhely létrehozáson kívül, képesek saját domaint is csatolni fiókjukhoz és az egyes webtárhelyekhez.</p>
<p>A fizetési kötelezettségek és befizetési elégtételeik is el vannak tárolva. Külön kerülnek ezek az adatok a két oldalhoz eltárolásra.</p>
<p>Folyamatos statisztikát állítunk elő és tároljuk el, hogy a felhasználók visszajelzést kaphassanak a látogatottsági számokról és az új egyedi látogatásokról, míg az "élő"/nap/heti adatokért más alrendszer felelős, a hosszútávú (havi) adatok az adatbázisban kerülnek letárolásra. Ezek az adatok, az egyes domain címekhez vannak csatolva.</p>
<p>Továbbá az adatbázis rendelkezik értesítésekkel, amik a felhasznélók figyelmét hivatottak felhívni és tájékoztatni esetleges hibákról vagy tervezett karbantartásokról. Például forgalomugrásról, befizetési kötelezettségekről, befizetett tranzakciókról, bérleti lejáratokról és így tovább.</p>
<blockquote>
<p>Az adatbázis MariaDB-hez készült, más adatbázis motorral nem volt tesztelve. (MariaDB 10.5)</p>
</blockquote>
<h2 id="kérdések">Kérdések</h2>
<ol>
<li>Hány <em>.com</em> TLD-jű domain van beregisztrálva a rendszerbe?</li>
</ol>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(d.TLD) <span class="hljs-keyword">as</span> AddressCount <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Domain</span> d
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> d.TLD
<span class="hljs-keyword">HAVING</span> d.TLD <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'com'</span>;</code></pre><p><img src="./queries/query1.png" alt="Query 1" title="Query 1"></p>
<ol start="2">
<li>Hol találhatók Adatközpontok és mi a jeligéjük?</li>
</ol>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> dc.City, CenterName(dc.City, dc.Number) <span class="hljs-keyword">as</span> Keyword <span class="hljs-keyword">FROM</span> DataCenter dc
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> Keyword;</code></pre><p><img src="./queries/query2.png" alt="Query 2" title="Query 2"></p>
<ol start="3">
<li>Mi a 3 legtöbb szerverteremmel rendelkező város neve? (Csokkenő sorrend és a darabszámok is jelenjenek meg)</li>
</ol>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> dc.City, <span class="hljs-keyword">COUNT</span>(dc.Id) <span class="hljs-keyword">as</span> <span class="hljs-keyword">Count</span> <span class="hljs-keyword">FROM</span> DataCenter dc
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> dc.City
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">Count</span> <span class="hljs-keyword">DESC</span>, dc.City
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">3</span>;</code></pre><p><img src="./queries/query3.png" alt="Query 3" title="Query 3"></p>
<ol start="4">
<li>Mely csomagok tartalmaznak PHP futtatási lehetőséget?</li>
</ol>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> st.Name <span class="hljs-keyword">FROM</span> StorageType st
<span class="hljs-keyword">WHERE</span> st.PHPEnabled;</code></pre><p><img src="./queries/query4.png" alt="Query 4" title="Query 4"></p>
<ol start="5">
<li>Mely webtárhelyek rendelkeznek SSH eléréssel és sávszélességük legalább 1 Gigabit/s, illetve mikor lettek ezek létrehozva?</li>
</ol>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s.Name, s.Creation <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Storage</span> s
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> StorageType st <span class="hljs-keyword">ON</span> st.Id = s.TypeId
<span class="hljs-keyword">WHERE</span> st.SSHEnabled <span class="hljs-keyword">AND</span> s.MaximumDataTraffic &gt;= <span class="hljs-number">1</span>;</code></pre><p><img src="./queries/query5.png" alt="Query 5" title="Query 5"></p>
<ol start="6">
<li>Mely webtárhelyek nem rendelkezik egy Domain címmel sem?</li>
</ol>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s.Name <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Storage</span> s
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">Domain</span> d <span class="hljs-keyword">ON</span> d.StorageId = s.Id
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> s.Name
<span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(d.Id) = <span class="hljs-number">0</span></code></pre><p><img src="./queries/query6.png" alt="Query 6" title="Query 6"></p>
<ol start="7">
<li>Van-e az <em>1</em>-es Id-val rendelkező felhasználónak közvetlen nem kifizetett számlája és mi annak az azonosítója?</li>
</ol>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> b.BillId <span class="hljs-keyword">FROM</span> Bill b
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> Payment p <span class="hljs-keyword">ON</span> p.BillId = b.Id
<span class="hljs-keyword">WHERE</span> b.UserId = <span class="hljs-number">1</span> &amp;&amp; p.Id <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> &amp;&amp; b.Deadline &gt;= <span class="hljs-keyword">NOW</span>();</code></pre><p><img src="./queries/query7.png" alt="Query 7" title="Query 7"></p>
<ol start="8">
<li>Melyek azok a domain címek, amikhez a kapcsolt tárhely lejárt és mikor?</li>
</ol>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> DomainAddress(d.DomainAddress, d.TLD) <span class="hljs-keyword">as</span> Address, s.Expiration <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Domain</span> d
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">Storage</span> s <span class="hljs-keyword">ON</span> s.Id = d.StorageId
<span class="hljs-keyword">WHERE</span> s.Expiration &lt;= <span class="hljs-keyword">NOW</span>();</code></pre><p><img src="./queries/query8.png" alt="Query 8" title="Query 8"></p>
<ol start="9">
<li>Milyen kifizetések történtek <em>2019-09-12</em> - <em>2020-02-23</em> között regisztrált felhasználóknak? Melyik felhasználónak és mi volt a tranzakció azonosítója?</li>
</ol>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> u.UserName, p.TransactionId <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">User</span> u
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Payment p <span class="hljs-keyword">ON</span> u.Id = p.UserId
<span class="hljs-keyword">WHERE</span> p.Date <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2019-09-12'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2020-02-23'</span>;</code></pre><p><img src="./queries/query9.png" alt="Query 9" title="Query 9"></p>
<ol start="10">
<li>Éves statisztika az egyes domain címekhez, amik tartalmazzák az összes látógatást és az összes egyedi látógatót.</li>
</ol>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> DomainAddress(d.DomainAddress, d.TLD) <span class="hljs-keyword">as</span> Address, <span class="hljs-keyword">YEAR</span>(s.Month) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">Year</span>, <span class="hljs-keyword">SUM</span>(s.Views) <span class="hljs-keyword">AS</span> ViewSum, <span class="hljs-keyword">SUM</span>(s.UniqueViewers) <span class="hljs-keyword">as</span> UViewSum <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Domain</span> d
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Statistic s <span class="hljs-keyword">ON</span> s.DomainId = d.Id
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> DomainAddress, <span class="hljs-keyword">Year</span>;</code></pre><p><img src="./queries/query10.png" alt="Query 10" title="Query 10"></p>
<ol start="11">
<li>Melyek azok az adatközpontok, ahol legalább a webtárhelyek fele rendelkezik adatbázissal, PHP-val és e-mail fiókkal is?</li>
</ol>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> CenterName(dc.City, dc.Number) <span class="hljs-keyword">AS</span> Center <span class="hljs-keyword">FROM</span> DataCenter dc
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">Storage</span> s <span class="hljs-keyword">on</span> dc.Id = s.DataCenterId
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> StorageType st <span class="hljs-keyword">on</span> s.TypeId = st.Id
<span class="hljs-keyword">WHERE</span> st.PHPEnabled &amp;&amp; st.MaximumEmailAccounts &gt; <span class="hljs-number">0</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> dc.Id
<span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(s.Id) &gt;= GetStorageNumber(dc.Id) / <span class="hljs-number">2</span>;</code></pre><p><img src="./queries/query11.png" alt="Query 11" title="Query 11"></p>
<ol start="12">
<li>Mely PHP futtatással rendelkező domainen lesz karbantartás a következő hónapban (30 nap), a <em>BUD1</em> adatközpontban?</li>
</ol>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> DomainAddress(d.DomainAddress, d.TLD) <span class="hljs-keyword">AS</span> Address <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Domain</span> d
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">Storage</span> s <span class="hljs-keyword">on</span> d.StorageId = s.Id
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> StorageType st <span class="hljs-keyword">on</span> s.TypeId = st.Id
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> DataCenter dc <span class="hljs-keyword">on</span> s.DataCenterId = dc.Id
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Notification n <span class="hljs-keyword">on</span> d.Id = n.DomainId
<span class="hljs-keyword">WHERE</span> dc.Name = <span class="hljs-string">'BUD1'</span> <span class="hljs-keyword">AND</span> st.PHPEnabled <span class="hljs-keyword">AND</span> n.Title = <span class="hljs-string">'maintenance'</span> <span class="hljs-keyword">AND</span> n.TimeFrameEnd &lt;= <span class="hljs-keyword">DATE_ADD</span>(<span class="hljs-keyword">NOW</span>(), <span class="hljs-built_in">INTERVAL</span> <span class="hljs-number">30</span> <span class="hljs-keyword">DAY</span>);</code></pre><p><img src="./queries/query12.png" alt="Query 12" title="Query 12"></p>
<ol start="13">
<li>Mely <em>.hu</em> domain nevek voltak az utóbbi <em>2 hónapban</em> befizetve?</li>
</ol>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> DomainAddress(d.DomainAddress, d.TLD) <span class="hljs-keyword">as</span> <span class="hljs-keyword">Domain</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Domain</span> d
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Bill b <span class="hljs-keyword">on</span> d.Id = b.DomainId
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Payment p <span class="hljs-keyword">on</span> b.Id = p.BillId
<span class="hljs-keyword">WHERE</span> d.TLD = <span class="hljs-string">'hu'</span> <span class="hljs-keyword">AND</span> p.Date &gt;= <span class="hljs-keyword">DATE_SUB</span>(<span class="hljs-keyword">NOW</span>(), <span class="hljs-built_in">INTERVAL</span> <span class="hljs-number">2</span> <span class="hljs-keyword">MONTH</span>);</code></pre><p><img src="./queries/query13.png" alt="Query 13" title="Query 13"></p>
<ol start="14">
<li>Az egyes felhasználók mennyi aktív értesítéssel rendelkeznek?</li>
</ol>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> u.UserName, GetActiveUserNotifications(u.Id) Notifications <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">User</span> u;</code></pre><p><img src="./queries/query14.png" alt="Query 14" title="Query 14"></p>
<ol start="15">
<li>Melyek azok a domain nevek, amelyek <em>Maxi</em> csomaggal rendelkeznek?</li>
</ol>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> DomainAddress(d.DomainAddress, d.TLD) <span class="hljs-keyword">as</span> Address <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Domain</span> d
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">Storage</span> s <span class="hljs-keyword">on</span> d.StorageId = s.Id
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> StorageType st <span class="hljs-keyword">on</span> s.TypeId = st.Id
<span class="hljs-keyword">WHERE</span> st.Name = <span class="hljs-string">'Maxi'</span>;</code></pre><p><img src="./queries/query15.png" alt="Query 15" title="Query 15"></p>
<ol start="16">
<li>Melyik a legterheltebb adatközpontok? (Foglalt GB / Látogatottság)</li>
</ol>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> CenterName(dt.City, dt.Number) <span class="hljs-keyword">AS</span> Center <span class="hljs-keyword">FROM</span> DataCenter dt
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">Storage</span> s <span class="hljs-keyword">on</span> dt.Id = s.DataCenterId
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">Domain</span> d <span class="hljs-keyword">on</span> s.Id = d.StorageId
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Statistic stat <span class="hljs-keyword">on</span> d.Id = stat.DomainId
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> dt.Id
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">SUM</span>(s.DatabaseSize / stat.Views);</code></pre><p><img src="./queries/query16.png" alt="Query 16" title="Query 16"></p>
<ol start="17">
<li>Kik azok a felhasználók, akik a határidő előtti napon fizették be a számlát? (és melyek ezek a számlák?)</li>
</ol>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> b.BillId, u.FullName <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">User</span> u
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Bill b <span class="hljs-keyword">on</span> u.Id = b.UserId
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Payment p <span class="hljs-keyword">on</span> b.Id = p.BillId
<span class="hljs-keyword">WHERE</span> p.Date &lt; b.Deadline <span class="hljs-keyword">AND</span> p.Date &gt; <span class="hljs-keyword">SUBDATE</span>(b.Deadline, <span class="hljs-built_in">INTERVAL</span> <span class="hljs-number">1</span> <span class="hljs-keyword">DAY</span>);</code></pre><ol start="18">
<li>A top 5 PHP futtatás nélküli weboldalak és tulajdonosaik, amelyek látogatottsága a legmagasabb?</li>
</ol>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> DomainAddress(d.DomainAddress, d.TLD) <span class="hljs-keyword">AS</span> DomainAdd, u.FullName <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Domain</span> d
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">Storage</span> s <span class="hljs-keyword">on</span> d.StorageId = s.Id
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> StorageType st <span class="hljs-keyword">on</span> s.TypeId = st.Id
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Statistic stat <span class="hljs-keyword">on</span> d.Id = stat.DomainId
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">User</span> u <span class="hljs-keyword">on</span> d.UserId = u.Id
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">NOT</span> st.PHPEnabled
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> DomainAdd
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">SUM</span>(stat.Views) <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">5</span>;</code></pre><p><img src="./queries/query18.png" alt="Query 18" title="Query 18"></p>
<div class="page-break"></div>

<h2 id="adatmodell">Adatmodell</h2>
<p><img src="WebStorage.png" alt="UML Adatbázis séma" title="UML Adatbázis séma"></p>
<div class="page-break"></div>

<h2 id="egyed-kapcsolat-diagram">Egyed-Kapcsolat diagram</h2>
<p><img src="EgyedKapcsolat.png" alt="Adatbázis Egyed-Kapcsolat diagram" title="Adatbázis Egyed-Kapcsolat diagram"></p>
<div class="page-break"></div>

<h2 id="relációs-séma">Relációs séma</h2>
<table>
<thead>
<tr>
<th>Adatbázis</th>
<th>Webtárhely (WebStorage)</th>
</tr>
</thead>
<tbody><tr>
<td>Felhasználók</td>
<td><strong>User</strong> (Id, FullName, UserName, Email, Password, Registration, Blocked, MaximumStorage)</td>
</tr>
<tr>
<td>Tárhely típus</td>
<td><strong>StorageType</strong> (Id, SSHEnabled, PHPEnabled, MaximumEmailAccounts, MaximumFTPAccounts, MaximumDatabaseNumber, PHPMemoryLimit, MaximumPHPExecutionTime, CPanelIsEnabled, BaseCost, DataTrafficMultiplier)</td>
</tr>
<tr>
<td>Szerver központ</td>
<td><strong>DataCenter</strong> (Id, Name, City, Number, Area, StorageCapacity)</td>
</tr>
<tr>
<td>Tárhely</td>
<td><strong>Storage</strong> (Id, UserId, Creation, Expiration, TypeId, Size, MaximumDataTraffic, EmailStorageSize, DatabaseSize, DataCenterId, Cost, Name)</td>
</tr>
<tr>
<td>Domain név</td>
<td><strong>Domain</strong> (Id, UserId, DomainAddress, StorageId, TLD, Registration, Expiration, NameServer1, NameServer2, NameServer3, NameServer4)</td>
</tr>
<tr>
<td>Költségek</td>
<td><strong>Bill</strong> (Id, UserId, StorageId, DomainId, Date, Deadline, Cost, BillId)</td>
</tr>
<tr>
<td>Kifizetések</td>
<td><strong>Payment</strong> (Id, UserId, Date, TransactionId, BillId)</td>
</tr>
<tr>
<td>Statisztika</td>
<td><strong>Statistic</strong> (Id, DomainId, Month, Views, UniqueViewers)</td>
</tr>
<tr>
<td>Értesítések</td>
<td><strong>Notification</strong> (Id, UserId, StorageId, DomainId, Creation, TimeFrameStart, TimeFrameEnd, Title, Message, IsActive)</td>
</tr>
</tbody></table>
<div class="page-break"></div>

<h2 id="inputoutput-adatok-adattípusba-rendezve">Input/Output adatok adattípusba rendezve</h2>
<h3 id="user">User</h3>
<table>
<thead>
<tr>
<th>Mező</th>
<th>Típus</th>
<th align="right">Hossz</th>
<th align="center">Opcionális</th>
<th>Alapértelmezett érték</th>
</tr>
</thead>
<tbody><tr>
<td>Id</td>
<td>int</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>FullName</td>
<td>varchar</td>
<td align="right">60</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>UserName</td>
<td>varchar</td>
<td align="right">30</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>Email</td>
<td>varchar</td>
<td align="right">120</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>Password</td>
<td>varchar</td>
<td align="right">120</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>Registration</td>
<td>datetime</td>
<td align="right"></td>
<td align="center"></td>
<td><code>NOW()</code></td>
</tr>
<tr>
<td>Blocked</td>
<td>boolean</td>
<td align="right"></td>
<td align="center"></td>
<td><code>false</code></td>
</tr>
<tr>
<td>MaximumStorage</td>
<td>int</td>
<td align="right">4</td>
<td align="center"></td>
<td><code>5</code></td>
</tr>
</tbody></table>
<h3 id="storagetype">StorageType</h3>
<table>
<thead>
<tr>
<th>Mező</th>
<th>Típus</th>
<th align="right">Hossz</th>
<th align="center">Opcionális</th>
<th>Alapértelmezett érték</th>
</tr>
</thead>
<tbody><tr>
<td>Id</td>
<td>int</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>SSHEnabled</td>
<td>boolean</td>
<td align="right"></td>
<td align="center"></td>
<td><code>false</code></td>
</tr>
<tr>
<td>PHPEnabled</td>
<td>boolean</td>
<td align="right"></td>
<td align="center"></td>
<td><code>false</code></td>
</tr>
<tr>
<td>MaximumEmailAccounts</td>
<td>int</td>
<td align="right">5</td>
<td align="center">X</td>
<td></td>
</tr>
<tr>
<td>MaximumFTPAccounts</td>
<td>int</td>
<td align="right">5</td>
<td align="center">X</td>
<td></td>
</tr>
<tr>
<td>MaximumDatabaseNumber</td>
<td>int</td>
<td align="right">5</td>
<td align="center">X</td>
<td></td>
</tr>
<tr>
<td>PHPMemoryLimit</td>
<td>int</td>
<td align="right">6</td>
<td align="center">X</td>
<td></td>
</tr>
<tr>
<td>MaximumPHPExecutionTime</td>
<td>int</td>
<td align="right">3</td>
<td align="center">X</td>
<td></td>
</tr>
<tr>
<td>CPanelIsEnabled</td>
<td>boolean</td>
<td align="right"></td>
<td align="center"></td>
<td><code>false</code></td>
</tr>
<tr>
<td>BaseCost</td>
<td>decimal</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>DataTrafficMultiplier</td>
<td>int</td>
<td align="right">3</td>
<td align="center"></td>
<td><code>1</code></td>
</tr>
<tr>
<td>Name</td>
<td>varchar</td>
<td align="right">120</td>
<td align="center"></td>
<td></td>
</tr>
</tbody></table>
<div class="page-break"></div>

<h3 id="datacenter">DataCenter</h3>
<table>
<thead>
<tr>
<th>Mező</th>
<th>Típus</th>
<th align="right">Hossz</th>
<th align="center">Opcionális</th>
<th>Alapértelmezett érték</th>
</tr>
</thead>
<tbody><tr>
<td>Id</td>
<td>int</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>Name</td>
<td>varchar</td>
<td align="right">30</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>City</td>
<td>varchar</td>
<td align="right">80</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>Number</td>
<td>int</td>
<td align="right">2</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>Area</td>
<td>decimal</td>
<td align="right">X</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>StorageCapacity</td>
<td>int</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
</tbody></table>
<h3 id="storage">Storage</h3>
<table>
<thead>
<tr>
<th>Mező</th>
<th>Típus</th>
<th align="right">Hossz</th>
<th align="center">Opcionális</th>
<th>Alapértelmezett érték</th>
</tr>
</thead>
<tbody><tr>
<td>Id</td>
<td>int</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>UserId</td>
<td>int</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>Creation</td>
<td>datetime</td>
<td align="right"></td>
<td align="center"></td>
<td><code>NOW()</code></td>
</tr>
<tr>
<td>Expiration</td>
<td>datetime</td>
<td align="right"></td>
<td align="center"></td>
<td><code>DATE_ADD(NOW(), INTERVAL 1 YEAR)</code></td>
</tr>
<tr>
<td>TypeId</td>
<td>int</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>Size</td>
<td>int</td>
<td align="right">6</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>MaximumDataTraffic</td>
<td>int</td>
<td align="right">6</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>EmailStorageSize</td>
<td>int</td>
<td align="right">6</td>
<td align="center">X</td>
<td></td>
</tr>
<tr>
<td>DatabaseSize</td>
<td>int</td>
<td align="right">6</td>
<td align="center">X</td>
<td></td>
</tr>
<tr>
<td>Cost</td>
<td>decimal</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>Name</td>
<td>varchar</td>
<td align="right">80</td>
<td align="center"></td>
<td></td>
</tr>
</tbody></table>
<div class="page-break"></div>

<h3 id="domain">Domain</h3>
<table>
<thead>
<tr>
<th>Mező</th>
<th>Típus</th>
<th align="right">Hossz</th>
<th align="center">Opcionális</th>
<th>Alapértelmezett érték</th>
</tr>
</thead>
<tbody><tr>
<td>Id</td>
<td>int</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>UserId</td>
<td>int</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>DomainAddress</td>
<td>varchar</td>
<td align="right">253</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>StorageId</td>
<td>int</td>
<td align="right"></td>
<td align="center">X</td>
<td></td>
</tr>
<tr>
<td>TLD</td>
<td>varchar</td>
<td align="right">63</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>Registration</td>
<td>datetime</td>
<td align="right"></td>
<td align="center"></td>
<td><code>NOW()</code></td>
</tr>
<tr>
<td>Expiration</td>
<td>datetime</td>
<td align="right"></td>
<td align="center"></td>
<td><code>DATE_ADD(NOW(), INTERVAL 1 YEAR)</code></td>
</tr>
<tr>
<td>NameServer1</td>
<td>varchar</td>
<td align="right">253</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>NameServer2</td>
<td>varchar</td>
<td align="right">253</td>
<td align="center">X</td>
<td></td>
</tr>
<tr>
<td>NameServer3</td>
<td>varchar</td>
<td align="right">253</td>
<td align="center">X</td>
<td></td>
</tr>
<tr>
<td>NameServer4</td>
<td>varchar</td>
<td align="right">253</td>
<td align="center">X</td>
<td></td>
</tr>
</tbody></table>
<h3 id="bill">Bill</h3>
<table>
<thead>
<tr>
<th>Mező</th>
<th>Típus</th>
<th align="right">Hossz</th>
<th align="center">Opcionális</th>
<th>Alapértelmezett érték</th>
</tr>
</thead>
<tbody><tr>
<td>Id</td>
<td>int</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>UserId</td>
<td>int</td>
<td align="right"></td>
<td align="center">X</td>
<td></td>
</tr>
<tr>
<td>StorageId</td>
<td>int</td>
<td align="right"></td>
<td align="center">X</td>
<td></td>
</tr>
<tr>
<td>DomainId</td>
<td>int</td>
<td align="right"></td>
<td align="center">X</td>
<td></td>
</tr>
<tr>
<td>Date</td>
<td>datetime</td>
<td align="right"></td>
<td align="center"></td>
<td><code>NOW()</code></td>
</tr>
<tr>
<td>Deadline</td>
<td>datetime</td>
<td align="right"></td>
<td align="center"></td>
<td><code>DATE_ADD(NOW(), INTERVAL 1 MONTH)</code></td>
</tr>
<tr>
<td>Cost</td>
<td>decimal</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>BillId</td>
<td>varchar</td>
<td align="right">18</td>
<td align="center"></td>
<td></td>
</tr>
</tbody></table>
<h3 id="payment">Payment</h3>
<table>
<thead>
<tr>
<th>Mező</th>
<th>Típus</th>
<th align="right">Hossz</th>
<th align="center">Opcionális</th>
<th>Alapértelmezett érték</th>
</tr>
</thead>
<tbody><tr>
<td>Id</td>
<td>int</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>UserId</td>
<td>int</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>Date</td>
<td>datetime</td>
<td align="right"></td>
<td align="center"></td>
<td><code>NOW()</code></td>
</tr>
<tr>
<td>TranscactionId</td>
<td>varchar</td>
<td align="right">30</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>BillId</td>
<td>int</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
</tbody></table>
<h3 id="statistic">Statistic</h3>
<table>
<thead>
<tr>
<th>Mező</th>
<th>Típus</th>
<th align="right">Hossz</th>
<th align="center">Opcionális</th>
<th>Alapértelmezett érték</th>
</tr>
</thead>
<tbody><tr>
<td>Id</td>
<td>int</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>DomainId</td>
<td>int</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>Month</td>
<td>date</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>Views</td>
<td>int</td>
<td align="right"></td>
<td align="center"></td>
<td><code>0</code></td>
</tr>
<tr>
<td>UniqueViewers</td>
<td>int</td>
<td align="right"></td>
<td align="center"></td>
<td><code>0</code></td>
</tr>
</tbody></table>
<h3 id="notification">Notification</h3>
<table>
<thead>
<tr>
<th>Mező</th>
<th>Típus</th>
<th align="right">Hossz</th>
<th align="center">Opcionális</th>
<th>Alapértelmezett érték</th>
</tr>
</thead>
<tbody><tr>
<td>Id</td>
<td>int</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>UserId</td>
<td>int</td>
<td align="right"></td>
<td align="center">X</td>
<td></td>
</tr>
<tr>
<td>StorageId</td>
<td>int</td>
<td align="right"></td>
<td align="center">X</td>
<td></td>
</tr>
<tr>
<td>DomainId</td>
<td>int</td>
<td align="right"></td>
<td align="center">X</td>
<td></td>
</tr>
<tr>
<td>Creation</td>
<td>datetime</td>
<td align="right"></td>
<td align="center"></td>
<td><code>NOW()</code></td>
</tr>
<tr>
<td>TimeFrameStart</td>
<td>datetime</td>
<td align="right"></td>
<td align="center">X</td>
<td></td>
</tr>
<tr>
<td>TimeFrameEnd</td>
<td>datetime</td>
<td align="right"></td>
<td align="center">X</td>
<td></td>
</tr>
<tr>
<td>Title</td>
<td>varchar</td>
<td align="right">100</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>Message</td>
<td>longtext</td>
<td align="right"></td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>IsActive</td>
<td>boolean</td>
<td align="right"></td>
<td align="center"></td>
<td><code>true</code></td>
</tr>
</tbody></table>
<h2 id="elsődleges-kulcsok">Elsődleges kulcsok</h2>
<table>
<thead>
<tr>
<th>Tábla</th>
<th>Mező</th>
</tr>
</thead>
<tbody><tr>
<td>User</td>
<td>Id</td>
</tr>
<tr>
<td>StorageType</td>
<td>Id</td>
</tr>
<tr>
<td>DataCenter</td>
<td>Id</td>
</tr>
<tr>
<td>Storage</td>
<td>Id</td>
</tr>
<tr>
<td>Domain</td>
<td>Id</td>
</tr>
<tr>
<td>Bill</td>
<td>Id</td>
</tr>
<tr>
<td>Payment</td>
<td>Id</td>
</tr>
<tr>
<td>Statistic</td>
<td>Id</td>
</tr>
<tr>
<td>Notification</td>
<td>Id</td>
</tr>
</tbody></table>
<div class="page-break"></div>

<h2 id="megszorítások">Megszorítások</h2>
<h3 id="idegen-kulcsok">Idegen kulcsok</h3>
<table>
<thead>
<tr>
<th>Tábla</th>
<th>Mezők</th>
</tr>
</thead>
<tbody><tr>
<td>Storage</td>
<td>UserId, TypeId, DataCenterId</td>
</tr>
<tr>
<td>Domain</td>
<td>UserId, StorageId</td>
</tr>
<tr>
<td>Bill</td>
<td>UserId, StorageId, DomainId</td>
</tr>
<tr>
<td>Payment</td>
<td>UserId, BillId</td>
</tr>
<tr>
<td>Statistic</td>
<td>DomainId</td>
</tr>
<tr>
<td>Notification</td>
<td>UserId, StorageId, DomainId</td>
</tr>
</tbody></table>
<h3 id="egyedi-kulcsok">Egyedi kulcsok</h3>
<table>
<thead>
<tr>
<th>Tábla</th>
<th>Mezők</th>
</tr>
</thead>
<tbody><tr>
<td>User</td>
<td>UserName, Email</td>
</tr>
<tr>
<td>DataCenter</td>
<td>Name</td>
</tr>
<tr>
<td>Storage</td>
<td>UserId, Name</td>
</tr>
<tr>
<td>Domain</td>
<td>DomainAddress, TLD</td>
</tr>
<tr>
<td>Bill</td>
<td>BillId</td>
</tr>
<tr>
<td>Payment</td>
<td>Transactionid</td>
</tr>
<tr>
<td>Statistic</td>
<td>DomainId, Month</td>
</tr>
</tbody></table>
<div class="page-break"></div>

<h3 id="egyéb-megszorítások">Egyéb megszorítások</h3>
<ul>
<li>Felhasználók<ul>
<li>E-mail cím<ul>
<li>Név: A-Za-z0-9 + - = _ (1-64 karakter)</li>
<li>@</li>
<li>Domain: A-Za-z0-9 - . (1-253 karakter)</li>
<li>TLD: A-Za-z (2+ karakter)</li>
<li>Regex: <code>[A-Za-z0-9\+\-\=\_]{1,64}@[A-Za-z0-9\-\.]{1,253}\.[A-Za-z]{2,}</code></li>
</ul>
</li>
</ul>
</li>
<li>Domain<ul>
<li>Domain név<ul>
<li>A-Za-z0-9 - . (1-253 karakter)</li>
<li>Regex: <code>[A-Za-z0-9\-\.]{1,253}</code></li>
</ul>
</li>
<li>Lejárati dátum<ul>
<li>Regisztrációs dátum után</li>
</ul>
</li>
</ul>
</li>
<li>Storage<ul>
<li>Lejárat<ul>
<li>Létrehozva után</li>
</ul>
</li>
</ul>
</li>
<li>StorageTypes<ul>
<li>Adatbázisok száma, PHP memória limit, PHP max. végrehajtási idő<ul>
<li>Csak engedélyezett PHP mellett kitölthető</li>
</ul>
</li>
</ul>
</li>
<li>Bill<ul>
<li>Számla azonosító<ul>
<li>Regex: <code>BBKT-[0-9]{4}-[0-9]{8}</code></li>
</ul>
</li>
<li>Számla kötődés<ul>
<li>Legalább az egyiknek szerepelnie a három közül: <code>UserId</code>, <code>StorageId</code>, <code>DomainId</code></li>
</ul>
</li>
</ul>
</li>
<li>Payment<ul>
<li>Tranzakció azonosító<ul>
<li>Regex: <code>[0-9]+</code></li>
</ul>
</li>
</ul>
</li>
<li>Notification<ul>
<li>Időkeret kezdet<ul>
<li>kisebb mint Időkeret vége</li>
</ul>
</li>
<li>Tulajdonosi kapcsolat<ul>
<li>Legalább az egyiknek szerepelnie a három közül: <code>UserId</code>, <code>StorageId</code>, <code>DomainId</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="page-break"></div>

<h3 id="tárolt-eljárások">Tárolt eljárások</h3>
<ul>
<li><code>GetStoragePrice</code> - Tárhely ár kiszámítása</li>
<li><code>AreLimitsReached</code> - Limitek ellenőrzése<ul>
<li>van-e befizetetlen számla</li>
<li>felhasználói limit nem telt-e be</li>
</ul>
</li>
<li><code>CenterName</code> - Központ jeligéjének előállítása</li>
<li><code>GetStorageNumber</code> - Visszaadja a tárolók számát a paraméterben megadott köztpont Id alapaján</li>
<li><code>DomainAddress</code> - Domain cím előállítása a tagokból</li>
<li><code>GetActiveUserNotifications</code> - Lekéri a felhasználóhoz tartozó összes aktív értesítésnek a darabszámát</li>
<li><code>GetActiveDomainNotificationsByUser</code> - Lekéri a felhasználóhoz tartozó domain címekhez tartozó összes aktív értesítéseknek a darabszámát</li>
<li><code>GetActiveStorageNotificationsByUser</code> - Lekéri a felhasználóhoz tartozó web tárhyelhez tartozó összes aktív értesítéseknek a darabszámát</li>
<li><code>GetNextBillId</code> - A jelenlrg tárolt adatok alapján meghatározza a jelenlegi év következő számla azonosítóját</li>
</ul>
<h3 id="triggerek">Triggerek</h3>
<ul>
<li><code>CheckLimitsStorage</code> - Új tárhely létrehozás limitek ellenőrzése<ul>
<li><code>Storage</code> tábla - Beszúrás előtt</li>
<li><code>AreLimitsReached</code></li>
<li>Meghatározza a tárhelyhez tartozó költséget</li>
</ul>
</li>
<li><code>CheckLimitsDomain</code> - Új domain regisztráció limitek ellenőrzése<ul>
<li><code>Domain</code> tábla - Beszúrás előtt</li>
<li><code>AreLimitsReached</code></li>
</ul>
</li>
<li><code>CanEditUserProperties</code> - Felhasználó szerkesztés esetén, adott mezők szerkesztésének tiltása<ul>
<li><code>User</code> tábla - Frissítés előtt</li>
<li>A <em>UserName</em>, <em>Email</em>, <em>Registration</em> mezők nem szerkeszthetők</li>
</ul>
</li>
<li><code>AddBillId</code> - A számla létrehozásakor felülirja a számla azonosítót a következő helyes azonosítóval a tárolt adatok alapján</li>
<li><code>EditBillId</code> - Blokkolja a számla azonosító átírását módosítás közben</li>
<li><code>EditStorage</code> - Meghatározza a tárhelyhez tartozó költséget módosítás után</li>
</ul>
<div class="page-break"></div>

<h2 id="kód-elérése">Kód elérése</h2>
<ul>
<li>Amennyiben ez a fájl zip fájlba volt csomagolva, úgy az SQL fájlok is mellékelve vannak.</li>
<li>Egyéb esetben minden fájl a Github repositoryban elérhető: <a href="https://github.com/sze-plusplusplus/adatbazisok">https://github.com/sze-plusplusplus/adatbazisok</a></li>
<li>Aktuális PDF fájl (automatikusan generált): <a href="https://sze-plusplusplus.github.io/adatbazisok/webtarhely_adatbazis_plusplusplus.pdf">https://sze-plusplusplus.github.io/adatbazisok/webtarhely_adatbazis_plusplusplus.pdf</a></li>
</ul>
<hr>
<small>
Frissítve: 2021. 04. 07. 19:01:52 Feltöltő: karcagtamas - Commit: 406e5e94da26f8dbe41edd5ba2f1a5d65867c0a9
</small>



</body></html>